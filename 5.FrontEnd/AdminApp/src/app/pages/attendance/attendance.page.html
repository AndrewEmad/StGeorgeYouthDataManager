<div class="animate-slide">
  <app-content-header
    title="تسجيل الحضور"
    subtitle="تسجيل حضور المخدومين أو الخدام لليوم المحدد"
  />

  <app-card class="attendance-card">
    <div class="mode-tabs">
      <button type="button" class="tab" [class.active]="mode === 'students'" (click)="setMode('students')">حضور المخدومين</button>
      <button type="button" class="tab" [class.active]="mode === 'servants'" (click)="setMode('servants')">حضور الخدام</button>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label>التاريخ</label>
        <span class="date-input-wrap" (click)="dateInput.showPicker()"><input #dateInput type="date" [(ngModel)]="attendanceDate" class="form-input" /></span>
      </div>
      <div class="form-group flex-grow">
        <label>بحث بالاسم</label>
        <input type="text" [(ngModel)]="nameFilter" (ngModelChange)="onFilterChange()" class="form-input" placeholder="اكتب الاسم للتصفية..." />
      </div>
    </div>

    <p class="error-msg" *ngIf="error">{{ error }}</p>
    <p class="success-msg" *ngIf="success">{{ success }}</p>

    <div class="list-section">
      <div class="list-header">
        <label class="checkbox-label">
          <input type="checkbox" [checked]="mode === 'students' ? selectedStudentIds.size === studentList.length && studentList.length > 0 : selectedServantIds.size === servantList.length && servantList.length > 0" (change)="mode === 'students' ? selectAllStudents() : selectAllServants()" />
          تحديد الكل
        </label>
        <span class="count" *ngIf="mode === 'students'">{{ selectedStudentIds.size }} من {{ studentList.length }}</span>
        <span class="count" *ngIf="mode === 'servants'">{{ selectedServantIds.size }} من {{ servantList.length }}</span>
      </div>
      <div class="list-body" *ngIf="mode === 'students'">
        <app-loader *ngIf="loading" />
        <div *ngIf="!loading && studentList.length === 0" class="empty">لا يوجد مخدومين أو لا توجد نتائج للبحث</div>
        <label *ngFor="let s of studentList" class="list-item">
          <input type="checkbox" [checked]="selectedStudentIds.has(s.id)" (change)="toggleStudent(s.id)" />
          <span>{{ s.fullName }}</span>
        </label>
      </div>
      <div class="list-body" *ngIf="mode === 'servants'">
        <app-loader *ngIf="loading" />
        <div *ngIf="!loading && servantList.length === 0" class="empty">لا يوجد خدام أو لا توجد نتائج للبحث</div>
        <label *ngFor="let u of servantList" class="list-item">
          <input type="checkbox" [checked]="selectedServantIds.has(u.id)" (change)="toggleServant(u.id)" />
          <span>{{ u.fullName }}</span>
        </label>
      </div>
    </div>

    <div class="form-actions">
      <button type="button" class="btn-primary" (click)="submit()" [disabled]="saving">
        {{ saving ? 'جاري الحفظ...' : 'تسجيل الحضور' }}
      </button>
    </div>
  </app-card>
</div>

<div class="animate-slide">
  <app-content-header
    title="ملخص نشاط الخدام"
    subtitle="تقرير منفصل"
    backLink="/dashboard/reports/servant-follow-up"
    backLabel="العودة لمتابعة الخدام"
  />
  <section class="report-section">
    <app-card class="filters">
      <label>من تاريخ <span class="date-input-wrap" (click)="dateFromInput.showPicker()"><input #dateFromInput type="date" [(ngModel)]="dateFrom" /></span></label>
      <label>إلى تاريخ <span class="date-input-wrap" (click)="dateToInput.showPicker()"><input #dateToInput type="date" [(ngModel)]="dateTo" /></span></label>
      <label>
        الخادم
        <select [(ngModel)]="servantIdFilter">
          <option value="">الكل</option>
          <option *ngFor="let s of servants" [value]="s.id">{{ s.fullName }}</option>
        </select>
      </label>
      <button type="button" class="btn-outline" (click)="onApplyFilters()">تطبيق</button>
    </app-card>
    <app-loader *ngIf="loading" />
    <p *ngIf="error" class="error-msg">{{ error }}</p>
    <app-card *ngIf="!loading && !error" class="table-container">
      <table>
        <thead>
          <tr>
            <th>الخادم</th>
            <th>عدد المخدومين المخصصين</th>
            <th>مكالمات في الفترة</th>
            <th>زيارات في الفترة</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let row of activitySummary">
            <td>{{ row.fullName }}</td>
            <td>{{ row.assignedCount }}</td>
            <td>{{ row.callsInPeriod }}</td>
            <td>{{ row.visitsInPeriod }}</td>
          </tr>
          <tr *ngIf="activitySummary.length === 0">
            <td colspan="4" class="text-muted">لا توجد بيانات</td>
          </tr>
        </tbody>
      </table>
    </app-card>
    <app-pagination
      *ngIf="totalCount > 0"
      [total]="totalCount"
      [page]="page"
      [pageSize]="pageSize"
      [pageSizeOptions]="pageSizeOptions"
      [currentPageCount]="activitySummary.length"
      (pageChange)="goToPage($event)"
      (pageSizeChange)="setPageSize($event)"
    />
  </section>
</div>

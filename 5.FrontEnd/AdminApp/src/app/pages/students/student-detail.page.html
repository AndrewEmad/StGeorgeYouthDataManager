<div class="animate-slide student-detail">
  <header class="content-header">
    <a routerLink="/dashboard/students" class="back-link">
      <span class="material-icons">arrow_forward</span>
      العودة لقائمة المخدومين
    </a>
  </header>

  <div *ngIf="loading" class="p-4 text-center">جاري التحميل...</div>

  <div *ngIf="!loading && student" class="detail-content">
    <section class="glass-card detail-section">
      <h2>بيانات المخدوم</h2>
      <dl class="detail-grid">
        <dt>الاسم الكامل</dt><dd>{{ student.fullName }}</dd>
        <dt>رقم التليفون</dt><dd>{{ student.phone }}</dd>
        <dt>تاريخ الميلاد</dt><dd>{{ formatDate(student.birthDate) }}</dd>
        <dt>المنطقة</dt><dd>{{ student.area || '—' }}</dd>
        <dt>الكلية</dt><dd>{{ student.college || '—' }}</dd>
        <dt>السنة الدراسية</dt><dd>{{ student.academicYear || '—' }}</dd>
        <dt>أب الاعتراف</dt><dd>{{ student.confessionFather || '—' }}</dd>
        <dt>الخادم</dt><dd><span *ngIf="student.servantName" class="badge">{{ student.servantName }}</span><span *ngIf="!student.servantName">—</span></dd>
        <dt>تاريخ الإنشاء</dt><dd>{{ student.createdAt ? formatDate(student.createdAt) : '—' }}</dd>
        <dt>آخر تحديث</dt><dd>{{ student.updatedAt ? formatDate(student.updatedAt) : '—' }}</dd>
      </dl>
    </section>

    <section class="glass-card detail-section" *ngIf="editHistory.length">
      <h2>سجل التعديلات</h2>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>التاريخ</th>
              <th>من قام بالتعديل</th>
              <th>التفاصيل</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let e of editHistory">
              <td>{{ formatDate(e.updatedAt) }}</td>
              <td>{{ e.updatedByUserName }}</td>
              <td>{{ e.details }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section class="glass-card detail-section">
      <h2>سجل المتابعة الهاتفية</h2>
      <div class="table-wrap">
        <table *ngIf="calls.length">
          <thead>
            <tr>
              <th>التاريخ</th>
              <th>الحالة</th>
              <th>ملاحظات</th>
              <th>متابعة قادمة</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let c of calls">
              <td>{{ formatDate(c.callDate) }}</td>
              <td>{{ callStatusLabel(c.callStatus) }}</td>
              <td>{{ c.notes || '—' }}</td>
              <td>{{ formatDate(c.nextFollowUpDate) }}</td>
            </tr>
          </tbody>
        </table>
        <p *ngIf="!calls.length" class="muted">لا توجد مكالمات مسجلة</p>
      </div>
    </section>

    <section class="glass-card detail-section">
      <h2>سجل الزيارات المنزلية</h2>
      <div class="table-wrap">
        <table *ngIf="visits.length">
          <thead>
            <tr>
              <th>التاريخ</th>
              <th>النتيجة</th>
              <th>ملاحظات</th>
              <th>زيارة قادمة</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let v of visits">
              <td>{{ formatDate(v.visitDate) }}</td>
              <td>{{ visitOutcomeLabel(v.visitOutcome) }}</td>
              <td>{{ v.notes || '—' }}</td>
              <td>{{ formatDate(v.nextVisitDate) }}</td>
            </tr>
          </tbody>
        </table>
        <p *ngIf="!visits.length" class="muted">لا توجد زيارات مسجلة</p>
      </div>
    </section>
  </div>

  <div *ngIf="!loading && !student" class="p-4 text-center muted">المخدوم غير موجود</div>
</div>

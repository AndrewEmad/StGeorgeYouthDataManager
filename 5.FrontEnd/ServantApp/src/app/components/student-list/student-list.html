<div class="container animate-fade">
  <header class="list-header">
    <div class="header-main">
      <a routerLink="/dashboard" class="btn-back">
        <span class="material-icons">arrow_forward</span>
      </a>
      <h1>قائمة المخدومين</h1>
    </div>
    <div class="search-box">
      <span class="material-icons search-icon">search</span>
      <input
        type="text"
        [(ngModel)]="searchTerm"
        (input)="onSearch()"
        class="form-input"
        placeholder="ابحث بالاسم أو المنطقة...">
    </div>
  </header>

  <div *ngIf="loading" class="loader-container">
    <div class="spinner"></div>
  </div>

  <ng-container *ngIf="!loading">
    <section *ngIf="filteredAssigned.length > 0" class="list-section">
      <h2 class="section-title">مخدوموني ({{ filteredAssigned.length }})</h2>
      <div class="students-grid">
        <div *ngFor="let student of filteredAssigned" class="glass-card student-card">
          <div class="student-info">
            <h3>{{ student.fullName }}</h3>
            <p><span class="material-icons">place</span> {{ student.area || '—' }}</p>
            <p><span class="material-icons">school</span> {{ student.college || '—' }}</p>
            <p *ngIf="student.lastAttendanceDate" class="last-attendance"><span class="material-icons">event_available</span> آخر حضور: {{ student.lastAttendanceDate | date:'dd/MM/yyyy' }}</p>
          </div>
          <div class="student-actions">
            <a [href]="'tel:' + student.phone" class="btn-icon call"><span class="material-icons">phone</span></a>
            <a [routerLink]="['/students', student.id]" class="btn-outline">التفاصيل</a>
          </div>
        </div>
      </div>
    </section>

    <section *ngIf="filteredUnassigned.length > 0" class="list-section">
      <h2 class="section-title">مخدومون غير مخصصين ({{ filteredUnassigned.length }})</h2>
      <div class="students-grid">
        <div *ngFor="let student of filteredUnassigned" class="glass-card student-card unassigned">
          <div class="student-info">
            <span class="badge unassigned-badge">غير مخصص</span>
            <h3>{{ student.fullName }}</h3>
            <p><span class="material-icons">place</span> {{ student.area || '—' }}</p>
            <p><span class="material-icons">school</span> {{ student.college || '—' }}</p>
            <p *ngIf="student.lastAttendanceDate" class="last-attendance"><span class="material-icons">event_available</span> آخر حضور: {{ student.lastAttendanceDate | date:'dd/MM/yyyy' }}</p>
          </div>
          <div class="student-actions">
            <button type="button" class="btn-primary sm" [disabled]="assigningId === student.id" (click)="assignToMe(student)">
              {{ assigningId === student.id ? 'جاري التخصيص...' : 'تخصيص لي' }}
            </button>
            <a [href]="'tel:' + student.phone" class="btn-icon call"><span class="material-icons">phone</span></a>
            <a [routerLink]="['/students', student.id]" class="btn-outline">التفاصيل</a>
          </div>
        </div>
      </div>
    </section>
  </ng-container>

  <div *ngIf="!loading && filteredAssigned.length === 0 && filteredUnassigned.length === 0" class="empty-state">
    <span class="material-icons">search_off</span>
    <p>لم يتم العثور على مخدومين</p>
  </div>
</div>
